# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å JOIN –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ –±–µ–∑ —Ü–µ–ª–∏

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥ –∑–≤–æ–Ω–∫–∞ (–±–µ–∑ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏), —Ç–æ `purpose_id` –æ—Å—Ç–∞–µ—Ç—Å—è `NULL`. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –∑–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM calls
JOIN call_purposes ON call_purposes.id = calls.purpose_id
```

**–ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç** –∑–∞–ø–∏—Å–∏ –∑–≤–æ–Ω–∫–æ–≤ –±–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª–∏, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –∑–≤–æ–Ω–∫–æ–≤.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ "–ë–µ–∑ —Ü–µ–ª–∏"**

–°–æ–∑–¥–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ü–µ–ª—å "–ë–µ–∑ —Ü–µ–ª–∏" –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ü–µ–ª—å.

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ü–µ–ª–∏**

–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–≤–æ–Ω–∫–∞ —Å –∏—Ç–æ–≥–æ–º, –Ω–æ –±–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ü–µ–ª—å "–ë–µ–∑ —Ü–µ–ª–∏".

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π**

–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ —Å `purpose_id = NULL` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞ —Ü–µ–ª—å "–ë–µ–∑ —Ü–µ–ª–∏".

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (`db/add_default_purpose.sql`):**

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ "–ë–µ–∑ —Ü–µ–ª–∏"
INSERT INTO call_purposes (name, description) VALUES
    ('–ë–µ–∑ —Ü–µ–ª–∏', '–ó–≤–æ–Ω–æ–∫ –±–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ü–µ–ª–∏')
ON CONFLICT (name) DO NOTHING;

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
UPDATE calls
SET purpose_id = (SELECT id FROM call_purposes WHERE name = '–ë–µ–∑ —Ü–µ–ª–∏')
WHERE purpose_id IS NULL;
```

### **Frontend (`CallNotification.jsx`):**

```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ü–µ–ª–∏ "–ë–µ–∑ —Ü–µ–ª–∏"
let finalPurposeId = selectedPurpose;
if (outcome && !selectedPurpose) {
  const noPurpose = callPurposes.find((p) => p.name === "–ë–µ–∑ —Ü–µ–ª–∏");
  if (noPurpose) {
    finalPurposeId = noPurpose.id;
  }
}
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```sql
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–≤–æ–Ω–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª—å—é
SELECT * FROM calls
JOIN call_purposes ON call_purposes.id = calls.purpose_id
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ –±–µ–∑ —Ü–µ–ª–∏
```

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```sql
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï –∑–≤–æ–Ω–∫–∏, –≤–∫–ª—é—á–∞—è –±–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª–∏
SELECT * FROM calls
JOIN call_purposes ON call_purposes.id = calls.purpose_id
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ –∑–∞–ø–∏—Å–∏, –≤–∫–ª—é—á–∞—è —Å —Ü–µ–ª—å—é "–ë–µ–∑ —Ü–µ–ª–∏"
```

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. **–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç:**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
psql -d your_database -f db/add_default_purpose.sql
```

### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∏–µ–Ω—Ç:**

```bash
cd client
npm run dev
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∑–≤–æ–Ω–∫–æ–≤ —Å —Ü–µ–ª—è–º–∏
SELECT
    c.id,
    c.caller_number,
    cp.name as purpose_name,
    c.outcome,
    c.created_at
FROM calls c
LEFT JOIN call_purposes cp ON cp.id = c.purpose_id
ORDER BY c.created_at DESC;
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –¶–µ–ª—å "–ë–µ–∑ —Ü–µ–ª–∏" –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `call_purposes`
- [ ] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ —Å `purpose_id = NULL` –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ü–µ–ª—å "–ë–µ–∑ —Ü–µ–ª–∏"
- [ ] JOIN –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∑–≤–æ–Ω–∫–æ–≤
- [ ] –ü–æ–ª–µ "–¶–µ–ª—å –∑–≤–æ–Ω–∫–∞" –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç—ã–º –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ü–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö** - –≤—Å–µ –∑–≤–æ–Ω–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ JOIN –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–∑–∂–µ –≤—ã–±—Ä–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–ª—å
- ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–∫–∏ –±–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª–∏
- ‚úÖ **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** - –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å `purpose_id = NULL`

## üîç –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### **–í—Å–µ –∑–≤–æ–Ω–∫–∏ —Å —Ü–µ–ª—è–º–∏:**

```sql
SELECT
    c.id,
    c.caller_number,
    cp.name as purpose_name,
    c.outcome,
    c.description
FROM calls c
JOIN call_purposes cp ON cp.id = c.purpose_id
ORDER BY c.created_at DESC;
```

### **–ó–≤–æ–Ω–∫–∏ –±–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª–∏:**

```sql
SELECT
    c.id,
    c.caller_number,
    c.outcome,
    c.created_at
FROM calls c
JOIN call_purposes cp ON cp.id = c.purpose_id
WHERE cp.name = '–ë–µ–∑ —Ü–µ–ª–∏'
ORDER BY c.created_at DESC;
```

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ü–µ–ª—è–º:**

```sql
SELECT
    cp.name as purpose_name,
    COUNT(*) as call_count,
    COUNT(CASE WHEN c.outcome = 'success' THEN 1 END) as successful_calls
FROM calls c
JOIN call_purposes cp ON cp.id = c.purpose_id
GROUP BY cp.name, cp.id
ORDER BY call_count DESC;
```
